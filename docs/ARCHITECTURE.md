# IgniteGigs - Technical Architecture

**Stack**: SvelteKit + Supabase + Stripe Connect + Tailwind CSS
**Generated by**: Ralph Architecture System

---

## System Overview

```
┌─────────────────────────────────────────────────────────────────┐
│                         CLIENTS                                  │
│            (Mobile-first responsive web app)                    │
└─────────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────┐
│                        VERCEL EDGE                               │
│     (CDN, Edge Functions, Preview Deployments, Analytics)       │
└─────────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────┐
│                       SVELTEKIT APP                              │
│  ┌────────────────┐  ┌────────────────┐  ┌────────────────┐    │
│  │     Pages      │  │   API Routes   │  │    Server      │    │
│  │   (SSR/CSR)    │  │  (+server.ts)  │  │    Actions     │    │
│  │                │  │                │  │                │    │
│  │  /             │  │  /api/stripe   │  │  Form handling │    │
│  │  /performers   │  │  /api/upload   │  │  Mutations     │    │
│  │  /book/[id]    │  │  /api/webhooks │  │                │    │
│  │  /dashboard    │  │                │  │                │    │
│  └────────────────┘  └────────────────┘  └────────────────┘    │
└─────────────────────────────────────────────────────────────────┘
                               │
           ┌───────────────────┼───────────────────┐
           ▼                   ▼                   ▼
┌────────────────────┐ ┌────────────────┐ ┌────────────────────┐
│     SUPABASE       │ │     STRIPE     │ │    CLOUDINARY      │
│  ┌──────────────┐  │ │    CONNECT     │ │   (Video/Image)    │
│  │   Postgres   │  │ │                │ │                    │
│  │   Database   │  │ │  - Payments    │ │  - Video upload    │
│  └──────────────┘  │ │  - Payouts     │ │  - Transcoding     │
│  ┌──────────────┐  │ │  - 8% fee      │ │  - Thumbnails      │
│  │     Auth     │  │ │  - Disputes    │ │  - CDN delivery    │
│  │  (Magic Link │  │ │                │ │                    │
│  │   + Google)  │  │ └────────────────┘ └────────────────────┘
│  └──────────────┘  │
│  ┌──────────────┐  │         ┌────────────────────┐
│  │   Realtime   │  │         │      RESEND        │
│  │  (Messages)  │  │         │   (Transactional   │
│  └──────────────┘  │         │      Email)        │
│  ┌──────────────┐  │         │                    │
│  │   Storage    │  │         │  - Booking confirm │
│  │   (Backup)   │  │         │  - New request     │
│  └──────────────┘  │         │  - Review reminder │
│  ┌──────────────┐  │         └────────────────────┘
│  │  Edge Funcs  │  │
│  │  (Cron jobs) │  │
│  └──────────────┘  │
└────────────────────┘
```

---

## Tech Stack Details

| Layer | Technology | Rationale |
|-------|------------|-----------|
| **Frontend** | SvelteKit 2.0 | Simpler than React, better DX, smaller bundles, Svelte 5 runes |
| **Styling** | Tailwind CSS 3.4 | Rapid UI dev, design system built-in, JIT compiler |
| **Language** | TypeScript 5.0 | Type safety, better tooling, IDE support |
| **Database** | Supabase (Postgres 15) | Free tier generous, realtime, RLS, PostGIS for geo |
| **Auth** | Supabase Auth | Magic links, Google OAuth, session management |
| **Payments** | Stripe Connect | Industry standard for marketplaces, UK support |
| **Media** | Cloudinary | Video transcoding, optimization, CDN |
| **Hosting** | Vercel | Perfect SvelteKit support, edge functions |
| **Email** | Resend | Modern API, React email templates |
| **Monitoring** | Vercel Analytics + Sentry | Performance + error tracking |

---

## Database Schema

### Core Tables

```sql
-- ============================================
-- USERS
-- ============================================
CREATE TABLE public.users (
  id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  email TEXT UNIQUE NOT NULL,
  full_name TEXT NOT NULL,
  avatar_url TEXT,
  phone TEXT,
  user_type TEXT CHECK (user_type IN ('performer', 'client', 'both')) DEFAULT 'client',
  email_verified BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Enable RLS
ALTER TABLE public.users ENABLE ROW LEVEL SECURITY;

-- Users can read their own data
CREATE POLICY "Users can read own data" ON public.users
  FOR SELECT USING (auth.uid() = id);

-- Users can update their own data
CREATE POLICY "Users can update own data" ON public.users
  FOR UPDATE USING (auth.uid() = id);

-- ============================================
-- PERFORMER PROFILES
-- ============================================
CREATE TABLE public.performer_profiles (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID UNIQUE REFERENCES public.users(id) ON DELETE CASCADE,

  -- Basic Info
  stage_name TEXT,
  bio TEXT,
  tagline TEXT, -- "Mesmerizing fire performances for unforgettable events"

  -- Location
  location_name TEXT NOT NULL, -- "Manchester, UK"
  location_lat DECIMAL(10, 8),
  location_lng DECIMAL(11, 8),
  travel_radius_miles INT DEFAULT 50,

  -- Performance Types
  performer_category TEXT[] NOT NULL DEFAULT '{}', -- ['fire', 'led']
  act_types TEXT[] NOT NULL DEFAULT '{}', -- ['fire_poi', 'fire_breathing', 'led_hoop']

  -- Pricing
  min_rate_pence INT, -- Minimum booking fee
  hourly_rate_pence INT,
  event_rate_pence INT, -- Typical event flat rate

  -- Stripe
  stripe_account_id TEXT,
  stripe_onboarding_complete BOOLEAN DEFAULT FALSE,

  -- Verification
  is_verified BOOLEAN DEFAULT FALSE,
  verification_badges TEXT[] DEFAULT '{}', -- ['insurance', 'dbs', 'peer_verified']
  insurance_verified_at TIMESTAMPTZ,

  -- Stats (denormalized for performance)
  avg_rating DECIMAL(3,2) DEFAULT 0,
  total_reviews INT DEFAULT 0,
  total_bookings INT DEFAULT 0,
  response_rate DECIMAL(3,2) DEFAULT 0, -- Percentage
  response_time_hours INT, -- Average response time

  -- Status
  is_active BOOLEAN DEFAULT TRUE,
  is_featured BOOLEAN DEFAULT FALSE,
  profile_complete BOOLEAN DEFAULT FALSE,

  -- Timestamps
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Indexes for search
CREATE INDEX idx_performer_location ON public.performer_profiles
  USING GIST (ST_MakePoint(location_lng, location_lat));
CREATE INDEX idx_performer_category ON public.performer_profiles
  USING GIN (performer_category);
CREATE INDEX idx_performer_act_types ON public.performer_profiles
  USING GIN (act_types);
CREATE INDEX idx_performer_active ON public.performer_profiles (is_active, is_verified);

-- Enable RLS
ALTER TABLE public.performer_profiles ENABLE ROW LEVEL SECURITY;

-- Anyone can read active profiles
CREATE POLICY "Anyone can read active profiles" ON public.performer_profiles
  FOR SELECT USING (is_active = true);

-- Performers can update own profile
CREATE POLICY "Performers can update own profile" ON public.performer_profiles
  FOR UPDATE USING (auth.uid() = user_id);

-- ============================================
-- PERFORMER MEDIA
-- ============================================
CREATE TABLE public.performer_media (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  performer_id UUID REFERENCES public.performer_profiles(id) ON DELETE CASCADE,

  media_type TEXT CHECK (media_type IN ('video', 'photo')) NOT NULL,
  url TEXT NOT NULL,
  thumbnail_url TEXT,
  cloudinary_public_id TEXT,

  title TEXT,
  description TEXT,

  is_primary BOOLEAN DEFAULT FALSE,
  sort_order INT DEFAULT 0,

  -- Video specific
  duration_seconds INT,

  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_media_performer ON public.performer_media (performer_id, sort_order);

-- ============================================
-- AVAILABILITY
-- ============================================
CREATE TABLE public.availability (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  performer_id UUID REFERENCES public.performer_profiles(id) ON DELETE CASCADE,

  date DATE NOT NULL,
  is_available BOOLEAN DEFAULT TRUE,
  is_booked BOOLEAN DEFAULT FALSE, -- True if confirmed booking exists
  notes TEXT,

  UNIQUE(performer_id, date)
);

CREATE INDEX idx_availability_lookup ON public.availability (performer_id, date, is_available);

-- ============================================
-- BOOKINGS
-- ============================================
CREATE TABLE public.bookings (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

  -- Parties
  performer_id UUID REFERENCES public.performer_profiles(id),
  client_id UUID REFERENCES public.users(id),

  -- Status
  status TEXT CHECK (status IN (
    'inquiry',      -- Initial request
    'pending',      -- Awaiting performer response
    'accepted',     -- Performer accepted, awaiting deposit
    'confirmed',    -- Deposit paid
    'completed',    -- Event done, final payment made
    'cancelled',    -- Cancelled by either party
    'declined',     -- Performer declined
    'disputed'      -- Payment dispute
  )) DEFAULT 'inquiry',

  -- Event Details
  event_date DATE NOT NULL,
  event_time TIME,
  event_end_time TIME,
  event_duration_hours DECIMAL(3,1),
  event_location TEXT NOT NULL,
  event_location_lat DECIMAL(10, 8),
  event_location_lng DECIMAL(11, 8),
  event_type TEXT, -- 'wedding', 'corporate', 'festival', 'private', 'other'
  event_details TEXT,
  guest_count INT,

  -- Pricing
  quoted_price_pence INT NOT NULL,
  agreed_price_pence INT,
  deposit_pence INT,
  platform_fee_pence INT, -- 8% of agreed_price
  performer_payout_pence INT, -- agreed_price - platform_fee

  -- Payment Status
  deposit_paid BOOLEAN DEFAULT FALSE,
  deposit_paid_at TIMESTAMPTZ,
  final_paid BOOLEAN DEFAULT FALSE,
  final_paid_at TIMESTAMPTZ,

  -- Stripe
  stripe_payment_intent_id TEXT,
  stripe_transfer_id TEXT,

  -- Timestamps
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  responded_at TIMESTAMPTZ,
  completed_at TIMESTAMPTZ
);

CREATE INDEX idx_booking_performer ON public.bookings (performer_id, status);
CREATE INDEX idx_booking_client ON public.bookings (client_id, status);
CREATE INDEX idx_booking_date ON public.bookings (event_date);

-- ============================================
-- MESSAGES
-- ============================================
CREATE TABLE public.messages (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  booking_id UUID REFERENCES public.bookings(id) ON DELETE CASCADE,
  sender_id UUID REFERENCES public.users(id),

  content TEXT NOT NULL,

  read_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_messages_booking ON public.messages (booking_id, created_at);

-- ============================================
-- REVIEWS
-- ============================================
CREATE TABLE public.reviews (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  booking_id UUID REFERENCES public.bookings(id),

  reviewer_id UUID REFERENCES public.users(id),
  reviewee_id UUID REFERENCES public.users(id),

  reviewer_type TEXT CHECK (reviewer_type IN ('client', 'performer')) NOT NULL,

  rating INT CHECK (rating BETWEEN 1 AND 5) NOT NULL,
  content TEXT,

  -- Specific ratings (optional)
  professionalism_rating INT CHECK (professionalism_rating BETWEEN 1 AND 5),
  communication_rating INT CHECK (communication_rating BETWEEN 1 AND 5),
  value_rating INT CHECK (value_rating BETWEEN 1 AND 5),

  is_public BOOLEAN DEFAULT TRUE,

  created_at TIMESTAMPTZ DEFAULT NOW(),

  UNIQUE(booking_id, reviewer_type)
);

CREATE INDEX idx_reviews_reviewee ON public.reviews (reviewee_id, is_public);

-- ============================================
-- PEER VOUCHES
-- ============================================
CREATE TABLE public.peer_vouches (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

  voucher_id UUID REFERENCES public.performer_profiles(id),
  vouchee_id UUID REFERENCES public.performer_profiles(id),

  skill_area TEXT NOT NULL, -- 'fire_safety', 'led_tech', 'professionalism', 'creativity'
  message TEXT,

  created_at TIMESTAMPTZ DEFAULT NOW(),

  UNIQUE(voucher_id, vouchee_id, skill_area)
);

-- ============================================
-- SAVED PERFORMERS (Client favorites)
-- ============================================
CREATE TABLE public.saved_performers (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  client_id UUID REFERENCES public.users(id) ON DELETE CASCADE,
  performer_id UUID REFERENCES public.performer_profiles(id) ON DELETE CASCADE,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(client_id, performer_id)
);

-- ============================================
-- TRIGGERS
-- ============================================

-- Update updated_at timestamp
CREATE OR REPLACE FUNCTION update_updated_at()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER update_users_updated_at
  BEFORE UPDATE ON public.users
  FOR EACH ROW EXECUTE FUNCTION update_updated_at();

CREATE TRIGGER update_performer_profiles_updated_at
  BEFORE UPDATE ON public.performer_profiles
  FOR EACH ROW EXECUTE FUNCTION update_updated_at();

CREATE TRIGGER update_bookings_updated_at
  BEFORE UPDATE ON public.bookings
  FOR EACH ROW EXECUTE FUNCTION update_updated_at();

-- Update performer stats when review is added
CREATE OR REPLACE FUNCTION update_performer_stats()
RETURNS TRIGGER AS $$
BEGIN
  UPDATE public.performer_profiles
  SET
    avg_rating = (
      SELECT AVG(rating)::DECIMAL(3,2)
      FROM public.reviews
      WHERE reviewee_id = (SELECT user_id FROM performer_profiles WHERE id = NEW.reviewee_id)
      AND reviewer_type = 'client'
      AND is_public = true
    ),
    total_reviews = (
      SELECT COUNT(*)
      FROM public.reviews
      WHERE reviewee_id = (SELECT user_id FROM performer_profiles WHERE id = NEW.reviewee_id)
      AND reviewer_type = 'client'
      AND is_public = true
    )
  WHERE user_id = NEW.reviewee_id;
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

---

## API Routes

### Authentication
- `POST /api/auth/signup` - Create account
- `POST /api/auth/login` - Magic link / Google OAuth
- `POST /api/auth/logout` - Sign out
- `GET /api/auth/session` - Get current session

### Performers
- `GET /api/performers` - Search performers (with filters)
- `GET /api/performers/[id]` - Get performer profile
- `POST /api/performers` - Create performer profile
- `PATCH /api/performers/[id]` - Update performer profile
- `POST /api/performers/[id]/media` - Upload media

### Bookings
- `POST /api/bookings` - Create booking request
- `GET /api/bookings` - List user's bookings
- `GET /api/bookings/[id]` - Get booking details
- `PATCH /api/bookings/[id]` - Update booking (accept/decline)
- `POST /api/bookings/[id]/messages` - Send message

### Payments
- `POST /api/stripe/connect` - Start Stripe Connect onboarding
- `GET /api/stripe/connect/callback` - Handle OAuth callback
- `POST /api/stripe/payment-intent` - Create payment intent
- `POST /api/stripe/webhooks` - Handle Stripe webhooks

### Reviews
- `POST /api/reviews` - Create review
- `GET /api/reviews/[performerId]` - Get performer reviews

---

## Project Structure

```
ignitegigs/
├── src/
│   ├── routes/
│   │   ├── +page.svelte                 # Landing page
│   │   ├── +layout.svelte               # Root layout
│   │   ├── +layout.server.ts            # Auth check
│   │   ├── (auth)/
│   │   │   ├── login/+page.svelte
│   │   │   ├── signup/+page.svelte
│   │   │   └── callback/+page.server.ts
│   │   ├── performers/
│   │   │   ├── +page.svelte             # Search/browse
│   │   │   ├── +page.server.ts          # Search API
│   │   │   └── [id]/
│   │   │       ├── +page.svelte         # Profile view
│   │   │       └── +page.server.ts
│   │   ├── book/
│   │   │   └── [id]/+page.svelte        # Booking flow
│   │   ├── dashboard/
│   │   │   ├── +layout.svelte           # Dashboard layout
│   │   │   ├── +page.svelte             # Overview
│   │   │   ├── bookings/+page.svelte    # Manage bookings
│   │   │   ├── profile/+page.svelte     # Edit profile
│   │   │   ├── calendar/+page.svelte    # Availability
│   │   │   ├── messages/+page.svelte    # Conversations
│   │   │   └── settings/+page.svelte    # Account settings
│   │   └── api/
│   │       ├── performers/+server.ts
│   │       ├── bookings/+server.ts
│   │       ├── stripe/
│   │       │   ├── connect/+server.ts
│   │       │   ├── payment-intent/+server.ts
│   │       │   └── webhooks/+server.ts
│   │       └── upload/+server.ts
│   ├── lib/
│   │   ├── components/
│   │   │   ├── ui/                      # Base components
│   │   │   │   ├── Button.svelte
│   │   │   │   ├── Input.svelte
│   │   │   │   ├── Card.svelte
│   │   │   │   └── ...
│   │   │   ├── performer/
│   │   │   │   ├── PerformerCard.svelte
│   │   │   │   ├── PerformerGrid.svelte
│   │   │   │   ├── VideoReel.svelte
│   │   │   │   └── ReviewList.svelte
│   │   │   ├── booking/
│   │   │   │   ├── BookingForm.svelte
│   │   │   │   ├── BookingCard.svelte
│   │   │   │   └── Calendar.svelte
│   │   │   └── layout/
│   │   │       ├── Header.svelte
│   │   │       ├── Footer.svelte
│   │   │       └── MobileNav.svelte
│   │   ├── server/
│   │   │   ├── supabase.ts              # Supabase client
│   │   │   ├── stripe.ts                # Stripe client
│   │   │   └── cloudinary.ts            # Upload helpers
│   │   ├── stores/
│   │   │   ├── auth.ts                  # Auth state
│   │   │   └── booking.ts               # Booking flow state
│   │   ├── utils/
│   │   │   ├── format.ts                # Formatters
│   │   │   └── validation.ts            # Zod schemas
│   │   └── types/
│   │       └── database.ts              # Generated Supabase types
│   └── app.css                          # Global styles
├── static/
│   ├── favicon.png
│   └── og-image.png
├── tests/
│   ├── unit/
│   └── e2e/
├── supabase/
│   ├── migrations/
│   └── seed.sql
├── .env.example
├── svelte.config.js
├── tailwind.config.js
├── tsconfig.json
├── package.json
└── README.md
```

---

## Implementation Phases

### Phase 1: Foundation (Week 1-2)
- [ ] Initialize SvelteKit project with TypeScript
- [ ] Set up Tailwind CSS with custom theme
- [ ] Configure Supabase project
- [ ] Create database schema with migrations
- [ ] Implement auth (magic link + Google)
- [ ] Build base UI components
- [ ] Create layout (header, footer, mobile nav)
- [ ] Deploy to Vercel (staging)

### Phase 2: Profiles (Week 3-4)
- [ ] Performer profile creation flow
- [ ] Cloudinary integration for video upload
- [ ] Profile edit page
- [ ] Performer search with filters
- [ ] Performer profile public view
- [ ] Location search (PostGIS)

### Phase 3: Booking (Week 5-6)
- [ ] Booking request form
- [ ] Booking management for performers
- [ ] Real-time messaging (Supabase Realtime)
- [ ] Email notifications (Resend)
- [ ] Availability calendar

### Phase 4: Payments (Week 7-8)
- [ ] Stripe Connect onboarding
- [ ] Payment flow (deposit + final)
- [ ] Platform fee calculation (8%)
- [ ] Payout to performers
- [ ] Webhook handling

### Phase 5: Polish (Week 9-10)
- [ ] Review system (two-sided)
- [ ] Admin dashboard
- [ ] SEO optimization
- [ ] Performance optimization
- [ ] Security audit
- [ ] Bug fixes

### Phase 6: Beta Launch (Week 11-12)
- [ ] Invite 50 performers from network
- [ ] Collect feedback
- [ ] Iterate on UX
- [ ] Prepare launch marketing

---

## Environment Variables

```env
# App
PUBLIC_APP_URL=https://ignitegigs.com

# Supabase
PUBLIC_SUPABASE_URL=https://xxx.supabase.co
PUBLIC_SUPABASE_ANON_KEY=xxx
SUPABASE_SERVICE_ROLE_KEY=xxx

# Stripe
PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_xxx
STRIPE_SECRET_KEY=sk_xxx
STRIPE_WEBHOOK_SECRET=whsec_xxx
STRIPE_CONNECT_CLIENT_ID=ca_xxx

# Cloudinary
CLOUDINARY_CLOUD_NAME=xxx
CLOUDINARY_API_KEY=xxx
CLOUDINARY_API_SECRET=xxx

# Resend
RESEND_API_KEY=re_xxx

# Sentry (optional)
SENTRY_DSN=xxx
```

---

## Getting Started

```bash
# Clone and install
cd /Users/q/PythonScript/Python/Vibe/products/ignitegigs
npm create svelte@latest . -- --template skeleton --typescript --prettier --eslint
npm install

# Install dependencies
npm install @supabase/supabase-js @supabase/auth-helpers-sveltekit
npm install stripe @stripe/stripe-js
npm install cloudinary
npm install resend
npm install zod
npm install -D tailwindcss postcss autoprefixer
npm install -D @tailwindcss/forms @tailwindcss/typography

# Initialize Tailwind
npx tailwindcss init -p

# Set up Supabase
npx supabase init
npx supabase start

# Run dev server
npm run dev
```

---

## Spawner Skills to Load

| Phase | Skill | What It Provides |
|-------|-------|------------------|
| Setup | `sveltekit` | App router patterns, load functions, form actions |
| Database | `supabase-backend` | RLS policies, migrations, edge functions |
| Auth | `supabase-auth` | Auth flows, session management |
| UI | `tailwind-ui` | Component patterns, responsive design |
| Payments | `stripe-payments` | Connect onboarding, webhooks |
| Testing | `playwright` | E2E test patterns |
| Security | `security-hardening` | OWASP, input validation |

---

*Architecture generated by Ralph*
